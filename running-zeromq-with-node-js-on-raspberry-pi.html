<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Running ZeroMQ with Node.js on Raspberry Pi | Cross Dominant</title><meta name="description" content="ZeroMQ is a lightweight messaging library and looks ideal for lower powered devices like the RPi. Building and running is pretty easy. These are more notes for myself for future reference."><link rel="shortcut icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" title="Cross DominantRSS Feed" href="/feed/"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:400,300,300italic,400italic,700,700italic"><link rel="stylesheet" href="/css/prism.css"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lekton"><link rel="stylesheet" href="/css/main.css"><script src="/js/prism.js"></script><!--if lt IE 9<script src="/js/html5shiv.js"></script>--><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-88610-4']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script><meta property="og:title" content="Running ZeroMQ with Node.js on Raspberry Pi | Cross Dominant"><meta property="og:type" content="article"><meta property="og:description" content="ZeroMQ is a lightweight messaging library and looks ideal for lower powered devices like the RPi. Building and running is pretty easy. These are more notes for myself for future reference."><meta property="og:url" content="http://conoroneill.net//undefined"><meta property="og:image" content="http://conoroneill.net.s3.amazonaws.com/wp-content/uploads/2015/09/zmq_logo.gif"><meta property="og:site_name" content="Cross Dominant"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@conoro"><body class="page-running-zeromq-with-node-js-on-raspberry-pi running-zeromq-with-node-js-on-raspberry-pi"><header class="masthead"><div class="container"><h1><a href="/">Cross Dominant</a></h1></div><div class="search-box"><script type="text/javascript">(function() {
  var cx = '001461447920948202874:5htheqgvd1w';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();</script><gcse:search></gcse:search></div></header><div class="content"><div class="container"><article class="post"><h1 class="lg title">Running ZeroMQ with Node.js on Raspberry Pi</h1><h2 class="sm date">20 Sep 2015</h2><p><a href="http://zeromq.org/">ZeroMQ</a> is a lightweight messaging library and looks ideal for lower powered devices like the RPi. Building and running is pretty easy. These are really just notes for myself for future reference.</p>
<p>I don&#39;t actually need a messaging system yet but I wanted to play around with one. Running a simple Request / Reply setup with Node.js on both Windows 10 and RPi was interesting. One advantage a message queue gives you over REST is that the receiver can be out of action and still get all transmitted messages when it recovers. You also have things like Pub/Sub etc. I&#39;ve been running the code <a href="http://blog.rastating.com/using-zeromq-with-node-js/">from here</a> 100% reliably for two days now on both setups. At some point I&#39;ll check max throughput on a Pi.</p>
<p>Installation on Raspberry Pi:</p>
<pre><code class="language-bash">cd
sudo apt-get install libtool pkg-config build-essential autoconf automake
mkdir build
cd build/
wget https://download.libsodium.org/libsodium/releases/libsodium-1.0.3.tar.gz
tar -zxvf libsodium-1.0.3.tar.gz
cd libsodium-1.0.3/
./configure
make
sudo make install
cd ..
wget http://download.zeromq.org/zeromq-4.1.3.tar.gz
tar -zxvf zeromq-4.1.3.tar.gz
cd zeromq-4.1.3/
./configure
make
sudo make install
sudo ldconfig
</code></pre>
<p>Test code for Request / Reply from <a href="http://blog.rastating.com/using-zeromq-with-node-js/">from here</a>:</p>
<p>server.js:</p>
<pre><code class="language-javascript">var zmq = require(&quot;zmq&quot;);  
var socket = zmq.socket(&quot;req&quot;);  
var counter = 0;

// Just a helper function for logging to the console with a timestamp.
function logToConsole (message) {  
    console.log(&quot;[&quot; + new Date().toLocaleTimeString() + &quot;] &quot; + message);
}

function sendMessage (message) {  
    logToConsole(&quot;Sending: &quot; + message);
    socket.send(message);
}

// Add a callback for the event that is invoked when we receive a message.
socket.on(&quot;message&quot;, function (message) {  
    // Convert the message into a string and log to the console.
    logToConsole(&quot;Response: &quot; + message.toString(&quot;utf8&quot;));
});

// Begin listening for connections on all IP addresses on port 9998.
socket.bind(&quot;tcp://*:9998&quot;, function (error) {  
    if (error) {
        logToConsole(&quot;Failed to bind socket: &quot; + error.message);
        process.exit(0);
    }
    else {
        logToConsole(&quot;Server listening on port 9998&quot;);

        // Increment the counter and send the value to the clients every second.
        setInterval(function () { sendMessage(counter++); }, 1000);
    }
});
</code></pre>
<p>client.js:</p>
<pre><code class="language-javascript">var zmq = require(&quot;zmq&quot;);  
var socket = zmq.socket(&quot;rep&quot;);

// Just a helper function for logging to the console with a timestamp.
function logToConsole (message) {  
    console.log(&quot;[&quot; + new Date().toLocaleTimeString() + &quot;] &quot; + message);
}

// Add a callback for the event that is invoked when we receive a message.
socket.on(&quot;message&quot;, function (message) {  
    // Convert the message into a string and log to the console.
    logToConsole(&quot;Received message: &quot; + message.toString(&quot;utf8&quot;));

    // Send the message back aa a reply to the server.
    socket.send(message);
});

// Connect to the server instance.
socket.connect(&#39;tcp://127.0.0.1:9998&#39;);
</code></pre><section class="comments"><h2>Discuss</h2><div id="disqus_thread"><script>var disqus_shortname = 'crossdominant';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div></section><nav class="post-nav"><ul class="clearfix"><li><a href="til-you-can-import-3d-models-from-tinkercad-to-minecraft-how-cool-is-that" title="TIL you can import 3D models from Tinkercad to Minecraft. How cool is that?" class="post-prev"><strong>Previous Post</strong><span>TIL you can import 3D models from Tinkercad to Minecraft. How cool is that?</span></a></li></ul></nav></article></div></div></body></head></html>