<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controlling an i-racer RC car using a Wii Balance Board and @Raspberry_Pi &middot; Cross Dominant</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.14" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Controlling an i-racer RC car using a Wii Balance Board and @Raspberry_Pi &middot; Cross Dominant">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Controlling an i-racer RC car using a Wii Balance Board and @Raspberry_Pi &middot; Cross Dominant">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="http://conoroneill.net//css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Cross Dominant" href="http://conoroneill.net/feed/" />
</head>
<body>



<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="http://conoroneill.net/">Cross Dominant</a></h1>
            <h2 class="brand-tagline"> Mixed laterality since 1968 </h2>
        </hgroup>			
        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/conoro"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/conoro "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="http://conoroneill.net//index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
		<script>
  (function() {
    var cx = '001461447920948202874:5htheqgvd1w';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">07 May 2013, 08:17</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://conoroneill.net/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi.html" class="post-title">Controlling an i-racer RC car using a Wii Balance Board and @Raspberry_Pi</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-share">
                        <div class="post-share-links">
                            <h4 style="">Share</h4>
                            <a href="#" data-type="facebook" data-url="http://conoroneill.net/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi.html" data-title="Controlling an i-racer RC car using a Wii Balance Board and @Raspberry_Pi" data-description="" data-media="" class="prettySocial fa fa-facebook"></a>
                            <a href="#" data-type="googleplus" data-url="http://conoroneill.net/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi.html" data-description="" class="prettySocial fa fa-google-plus"></a>
                            
                            
                        </div>
                    </div>
                    <div class="post-description">
                        <p>#&ldquo;Controlling an i-racer RC car using a Wii Balance Board and @Raspberry_Pi&rdquo;</p>

<p>I love watching ideas bounce back and forward between people on Twitter and see them grow. The best for me recently started when <a href="http://www.theverge.com/2013/5/2/4292712/fitscales-wii-fit-balance-board-connected-scale">The Verge posted a story</a> about an OpenSource Android App which basically turned a <a href="http://wiibrew.org/wiki/Wii_Balance_Board">Wii Balance Board</a> into a Withings weighing scales, including RunKeeper and Fitbit integration. I retweeted it and it was picked up by <a href="https://twitter.com/joedesbonnet">Joe Desbonnet</a>. He realised you could also do some interesting things with the Balance Board and a Raspberry Pi and started hacking. Which of course made me realise I could control the i-racer with it!</p>

<p>Here&rsquo;s a wee video of it in action:</p>

<p>httpv://youtu.be/8cdn_LFKQXI</p>

<p>Apologies for the mobile interference in the audio. I was using my new SGS4 to SSH to the Raspberry Pi to kick off the Python code. The ConnectBot guys really need to fix the microscopic font on screens like the SGS4!</p>

<p>The car isn&rsquo;t very fast in the video as the Lego added a lot of weight and I hardcoded the speed to 50%. We&rsquo;ll try again next weekend using a lighter shell, full speed and tarmac instead of cobblelock.</p>

<h2>Technical Nitty Gritty (not too Gritty!)</h2>
My initial experiments with the Balance Board did not go well. Eventually I discovered that the version of the cwiid Wii library that is available on Raspberry Pi (and Ubuntu etc) is not able to deal with the Balance Board. See <a href="https://bugs.launchpad.net/ubuntu/+source/cwiid/+bug/509246">this bug</a>. I applied <a href="https://launchpadlibrarian.net/115501163/balanceboard.patch">the patch</a> and re-built my own deb files. To use them, just unzip them on the raspberry pi and install like so:

<pre><code class="language-bash">
wget https://github.com/conoro/iracer-controllers/raw/master/iracer_balance_board/cwiid_for_balance_board.zip
unzip cwiid_for_balance_board.zip
sudo dpkg -i *.deb
</code></pre> 

The rest of the time was just spent tweaking the numbers so that I could interpret someone leaning in various directions irrespective of their weight. It's still not great but works for me, a 7yo and a 6yo.

All the old i-racer Bluetooth code carried over unchanged from our <a href="http://conoroneill.net/makey-makey-raspberry-pi-iracer-bluetooth-cheese-controlled-car-ccc/">Cheese Controlled Car</a>. Follow the instructions there for installing various Bluetooth bits and bobs on the Raspberry Pi.

I was very surprised that I could talk to both the i-racer and the Balance Board over the same $2 Bluetooth adapter. I was sure I'd end up having to use two adapters.

You can, as ever, <a href="https://github.com/conoro/iracer-controllers/tree/master/iracer_balance_board">grab the code from Github</a>. The only changes you need to make in the code are to set the Bluetooth MAC addresses of both the Balance Board and the i-racer.

Sidenote: The Android App was a dead end. It doesn't work on Android 4.2 because Google decided to upgrade their broken Bluetooth stack and actually managed to make it worse.

Any questions, leave a comment.

<h2>Only if you really need it: Building those cwiid libraries yourself</h2>

<pre><code class="language-bash">
sudo nano /etc/apt/sources.list
</code></pre>

<p>Add the following line:
<pre><code class="language-bash">
deb-src <a href="http://archive.raspbian.org/raspbian">http://archive.raspbian.org/raspbian</a> wheezy main contrib non-free rpi
</code></pre></p>

<p>Then do the following:</p>

<pre><code class="language-bash">
mkdir ~/build
cd build
apt-get source python-cwiid
apt-get build-dep python-cwiid
cd cwiid-0.6.00+svn201/
</code></pre>

<p>Then edit these three files and add the changes from <a href="https://launchpadlibrarian.net/115501163/balanceboard.patch">https://launchpadlibrarian.net/115501163/balanceboard.patch</a> (or run &ldquo;patch&rdquo; if you are familiar with that)</p>

<pre><code class="language-bash">
nano libcwiid/cwiid_internal.h
nano libcwiid/process.c
nano libcwiid/thread.c
dpkg-source --commit
dpkg-buildpackage -us -uc
cd ..
sudo apt-get remove python-cwiid
sudo dpkg -i *.deb
</code></pre>

                    </div>
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'crossdominant';
    var disqus_identifier = 'http:\/\/conoroneill.net\/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi\/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi.html';
    var disqus_title = 'Controlling an i-racer RC car using a Wii Balance Board and @Raspberry_Pi';
    var disqus_url = 'http:\/\/conoroneill.net\/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi\/controlling-an-i-racer-rc-car-using-a-wii-balance-board-and-raspberry_pi.html';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </section>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a>. Copyright Conor O'Neill 2010</li>
        </ul>
    </div>
</div>
<script src="http://conoroneill.net//js/all.min.js"></script>
        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-88610-4', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
