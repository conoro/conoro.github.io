<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introducing the Bandon Bluetooth Button (BBB) using RN42 HID &middot; Cross Dominant</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.15" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Introducing the Bandon Bluetooth Button (BBB) using RN42 HID &middot; Cross Dominant">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Introducing the Bandon Bluetooth Button (BBB) using RN42 HID &middot; Cross Dominant">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="http://conoroneill.net//css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Cross Dominant" href="" />
</head>
<body>



<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="http://conoroneill.net/">Cross Dominant</a></h1>
            <h2 class="brand-tagline"> Mixed laterality since 1968 </h2>
        </hgroup>			
        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/conoro"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/conoro "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="http://conoroneill.net/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
		<script>
  (function() {
    var cx = '001461447920948202874:5htheqgvd1w';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">01 Dec 2013, 12:18</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://conoroneill.net/introducing-the-bandon-bluetooth-button-bbb-using-rn42-hid/" class="post-title">Introducing the Bandon Bluetooth Button (BBB) using RN42 HID</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-share">
                        <div class="post-share-links">
                            <h4 style="">Share</h4>
                            <a href="#" data-type="facebook" data-url="http://conoroneill.net/introducing-the-bandon-bluetooth-button-bbb-using-rn42-hid/" data-title="Introducing the Bandon Bluetooth Button (BBB) using RN42 HID" data-description="" data-media="" class="prettySocial fa fa-facebook"></a>
                            <a href="#" data-type="googleplus" data-url="http://conoroneill.net/introducing-the-bandon-bluetooth-button-bbb-using-rn42-hid/" data-description="" class="prettySocial fa fa-google-plus"></a>
                            
                            
                        </div>
                    </div>
                    <div class="post-description">
                        <p>#&ldquo;Introducing the Bandon Bluetooth Button (BBB) using RN42 HID&rdquo;</p>

<p>TL;DR - A Bluetooth-enabled Button/Joystick to control music/podcasts on your phone whilst driving.</p>

<p><a href="https://s3-eu-west-1.amazonaws.com/conoroneill.net/wp-content/uploads/2013/11/bbb01.jpg"><img class="size-large wp-image-1212 alignnone" alt="bbb01" src="https://s3-eu-west-1.amazonaws.com/conoroneill.net/wp-content/uploads/2013/11/bbb01-1024x849.jpg" width="584" height="484" /></a></p>

<p>One thing I find very dangerous in the car is changing tracks etc on my phone when it&rsquo;s in its screen mount. It&rsquo;s impossible to do so without taking your eye off the road even for a second. And it&rsquo;s illegal in many countries. I used to love the steering column controls for the old car radio but they don&rsquo;t work over A2DP or AVRCP Bluetooth to my phone which streams to my Lidl car stereo.</p>

<p>I&rsquo;ve made three attempts at solving this and I finally succeeded today.</p>

<p>The first attempt involved one of those cheap Chinese Bluetooth Serial modules like HC-05 or HC-06. I got pretty far with this and was able to send commands to my phone. But that&rsquo;s where I got stuck. I would need to write a native Android App to take those commands and broadcast them as media commands in the phone. I made some progress there but I was way out of my depth.</p>

<p>Whilst in the midst of that, Adafruit announced the <a href="http://learn.adafruit.com/introducing-bluefruit-ez-key-diy-bluetooth-hid-keyboard">Bluefruit</a>. We know how <a href="http://conoroneill.net/a-product-and-support-failure-by-adafruit-with-the-bluefruit-ez-key/">that turned out</a> for me, but if you want to make something like my BBB, I&rsquo;d recommend that route since you get almost everything out of the box.</p>

<p>Finally I settled on the Microchip Roving Networks RN42 HID Bluetooth module. It only cost 16.50 ex-VAT from <a href="http://ie.farnell.com/jsp/search/productdetail.jsp?sku=2143310&amp;CMP=i-bf9f-00001000">Farnell Element 14 in Ireland</a>. As usual with Farnell, you need to bump the order over 20 to get free (fast!) deliver. My big concern was to make sure I&rsquo;d get the right variant since there are quite a few. But since May 2013 it looks like the HID one is what they ship by default. Of course the big drawback is that this is an SMD module which isn&rsquo;t really designed for hand soldering into a hobby project. You can get them on breakout boards but it adds a lot to the cost. In the end the soldering was fine since it only really involved 4 wires and a stiff drink ;-) (Power, Ground, Serial Receive, Serial Transmit).</p>

<p>So what does it do? It&rsquo;s really very simple. You pair it to your phone and it appears as a combo Keyboard/Mouse device. You then send commands using an Arduino Nano to the RN42 and it sends them to the phone. The trick here is that the commands are &ldquo;Consumer Report&rdquo; ones which means Play/Pause, Next/Prev Track and Volume Up/Down (amongst many others). It&rsquo;s all powered by a LiPo battery I salvaged from some broken kids toy.</p>

<p>httpv://www.youtube.com/watch?v=IuH-1LcZlYo</p>

<p>It works beautifully and will take pride of place attached to my steering wheel as I wend my way around the country. Update: Just tested on an emergency drive from Bandon to Mount Mellary to collect a sick Boy Scout.</p>

<p><a href="https://s3-eu-west-1.amazonaws.com/conoroneill.net/wp-content/uploads/2013/12/2013-11-30-19.41.41.jpg"><img class="size-large wp-image-1214 alignnone" alt="2013-11-30 19.41.41" src="https://s3-eu-west-1.amazonaws.com/conoroneill.net/wp-content/uploads/2013/12/2013-11-30-19.41.41-1024x768.jpg" width="584" height="438" /></a></p>

<p>I have tested on an SGS4 but there is no reason it won&rsquo;t work on an iDevice unless Tim and Co have not implemented Consumer Report HID on iOS. Update: Tested and working beautifully on an iPhone 5 with iOS 7.</p>

<p>The only real issues I have so far are that it won&rsquo;t auto-connect to the phone (I think this is the SGS4&rsquo;s fault) and I haven&rsquo;t implemented any power saving. I&rsquo;m trying to sort auto-connect by using an NFC sticker to force the Samsung to connect. Not much joy yet. Power-saving should be easy to do since the joystick itself could be used to wake everything up. In the meantime I&rsquo;ll just unplug when not in use and charge the battery every once in a while from the cigarette lighter socket using one of these very neat <a href="http://dx.com/p/mini-usb-1a-lithium-battery-charging-board-charger-144856">$3 USB LiPo chargers</a> from the usual crew in DX in China.</p>

<p><a href="https://s3-eu-west-1.amazonaws.com/conoroneill.net/wp-content/uploads/2013/11/bbb02.jpg"><img class="aligncenter size-large wp-image-1213" alt="bbb02" src="https://s3-eu-west-1.amazonaws.com/conoroneill.net/wp-content/uploads/2013/11/bbb02-1024x911.jpg" width="584" height="519" /></a></p>

<p>One thing I haven&rsquo;t figured out is why it won&rsquo;t work with a 3.3V Arduino Pro Mini. The RN42 is a 3.3V device but only works with my 5V Arduinos like the Nano and the Uno. Is it possible the UART pins need 5V?</p>

<p>The Bill of Materials is as follows:
<ul>
    <li><a href="http://dx.com/p/repair-parts-replacement-analog-stick-module-for-ps2-controller-black-121340"><span style="line-height: 15px;">Cheap Chinese Joystick Module</span></a></li>
    <li><a href="http://www.elecfreaks.com/store/arduino-nano-p-14.html">Arduino Nano</a></li>
    <li><a href="http://ie.farnell.com/jsp/search/productdetail.jsp?sku=2143310&amp;CMP=i-bf9f-00001000">RN42 HID</a></li>
    <li>3.7V Lipo Battery</li>
    <li>Double sided foam tape :-)</li>
    <li>A few headers</li>
    <li>NFC Sticker</li>
</ul>
Wiring is beyond easy: TX on Arduino to RX on RN42. RX on Arduino to TX on RN42. 3V3 on Arduino to VCC on RN42. GND on Arduino to GND on RN42.</p>

<p><a href="https://github.com/conoro/bandon-bluetooth-button">My code</a> is trivially simple and uses my improved version of <a href="https://github.com/baselsw/BPLib">an existing Arduino library</a> called BPLib to talk to the RN42. I had to modify the library to work on anything other than an Arduino Mega but that was a simple search/replace. I also added a bunch of the Consumer Report functions to the library if you want to make use of them. They are:
<ul>
    <li>void volumeUp();</li>
    <li>void volumeDown();</li>
    <li>void muteAudio();</li>
    <li>void playPause();</li>
    <li>void nextTrack();</li>
    <li>void prevTrack();</li>
    <li>void stopAudio();</li>
    <li>void fastForwardAudio();</li>
    <li>void rewindAudio();</li>
    <li>void keyRelease();</li>
</ul>
My Arduino sketch and library are available <a href="https://github.com/conoro/bandon-bluetooth-button">on GitHub here</a>. Edit the ino file to suit yourself e.g. shorten a lot of the overly conservative delays or add proper power management. The BPLib directory should be dropped into the libraries sub-directory of your Arduino IDE installation.</p>

<p>One thing to be careful of is that most Arduinos only have one serial port. So if you have the RN42 attached to the serial pins and powered up, then you won&rsquo;t be able to program the Arduino using the IDE until you disconnect power or RX/TX to the RN42.</p>

<p>As always, any questions, let me know in the comments.</p>

<p>UPDATE: I&rsquo;ve been using it for two days now and I love it! One problem I&rsquo;ve run into which should have been obvious is that once I pull the power, the BBB forgets what it has been paired to. So when I reconnect power, the phone thinks it is paired but the BBB doesn&rsquo;t and therefore connection fails. So I have to un-pair and re-pair. The solution is obviously to implement strong power management so the LiPo lasts more than the current 48hrs. I&rsquo;ll post new code when I have that figured out.</p>

<p>The other tiny problem is that play/pause on Android by default uses your main Music app rather than the last audio app you ran,. In my case I want it to control the Doggcatcher Podcast player. It&rsquo;s no biggie, I just have to manually open Doggcatcher at the start of a journey and then the controls work perfectly.</p>

                    </div>
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'crossdominant';
    var disqus_identifier = 'http:\/\/conoroneill.net\/introducing-the-bandon-bluetooth-button-bbb-using-rn42-hid\/';
    var disqus_title = 'Introducing the Bandon Bluetooth Button (BBB) using RN42 HID';
    var disqus_url = 'http:\/\/conoroneill.net\/introducing-the-bandon-bluetooth-button-bbb-using-rn42-hid\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </section>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a>. Copyright Conor O'Neill 2010</li>
        </ul>
    </div>
</div>
<script src="http://conoroneill.net/js/all.min.js"></script>
        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-88610-4', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
